<!DOCTYPE html>
<html>
    <head>
        <title>Group21-DublinBikes</title>
    
        <link rel="stylesheet" href="{{ url_for('static', filename='dublin_bikes_app.css') }}">
    
        <!-- Google Maps API：移除 callback，讓 JS 檔內自己控制 initMap() 呼叫 -->
        <script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}" async defer></script>
    </head>
<body>
    <!-- 导航栏 -->
    <div class="navbar">
        <div class="logo">Dublin Bikes</div>
        <div class="weather-container">
            <div class="weather" id="weather">Loading weather...</div>
        </div>
        <div class="nav-links">
            <a href="#">View Map</a>
            <a href="#">View Stations</a>
		</div>
    </div>

    <!-- 侧边栏和地图 -->
    <div class="container">
        <!-- 侧边栏 -->
        <div class="sidebar" style="padding-top: 50px;">
            <div class="map-buttons" style="margin-top: 50px;">
                <button id="map-view-btn" type="button">地图</button>
                <button id="satellite-view-btn" type="button">卫星图像</button>
                <button id="journey-planner-btn" type="button">Plan Your Journey</button>
            </div>
            <h2>Plan Your Journey</h2>
            <form id="route-planner-form">
                <div class="form-control">
                    <label for="start-location">Start location:</label>
                    <input type="text" id="start-location" placeholder="Enter start location..."/>
                </div>
                
                <div class="form-control">
                    <label for="end-location">End location:</label>
                    <input type="text" id="end-location" placeholder="Enter end location..."/>
                </div>
                
                <div class="form-control">
                    <label for="day-select">Select date:</label>
                    <select id="day-select">
                    <option value="Sunday">Sunday</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                </select>
                </div>
                
                <div class="form-control">
                    <label for="time-select">Select time:</label>
                    <select id="time-select">
                    <option value="5">5:00</option>
                    <option value="6">6:00</option>
                    <option value="7">7:00</option>
                    <option value="8">8:00</option>
                    <option value="9">9:00</option>
                    <option value="10">10:00</option>
                    <option value="11">11:00</option>
                    <option value="12">12:00</option>
                    <option value="13">13:00</option>
                    <option value="14">14:00</option>
                    <option value="15">15:00</option>
                    <option value="16">16:00</option>
                    <option value="17">17:00</option>
                    <option value="18">18:00</option>
                    <option value="19">19:00</option>
                    <option value="20">20:00</option>
                    <option value="21">21:00</option>
                </select>
                </div>
                
                <div class="form-control">
                    <button type="button" id="plan-journey-btn">Plan route</button>
                </div>
            </form>
            
            <!-- 路线详情容器 -->
            <div id="route-details" style="display: none;">
                <h3>Route details</h3>
                <div id="route-details-content"></div>
            </div>
            
            <!-- 添加站点详情面板 -->
            <div id="station-details" style="display: none;">
                <h3>Station details</h3>
                <div id="station-info-content"></div>
            </div>
        </div>

        <!-- 地图部分 -->
        <div class="map">
            <div id="map" style="width: 100%; height: 100%;">
                <!-- 移除Google Maps API的异步加载
                <script>
                    // 改为不依赖Google API的初始化
                    window.onload = function() {
                        // 如果没有Google Maps API，则使用备用初始化方法
                        if (typeof google === 'undefined') {
                            console.log("Google Maps API 不可用，使用备用地图显示");
                            initMapWithoutAPI();
                        } else {
                            loadGoogleMapsScript();
                        }
                    };
                    
                    function loadGoogleMapsScript() {
                        try {
                            const script = document.createElement('script');
                            script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyBm9UnzDLdgIHQ1i_Fp4zfRZL6nuEM73t8&libraries=places,directions&language=zh-CN&callback=initMap';
                            script.async = true;
                            script.defer = true;
                            script.onerror = function() {
                                console.error("加载Google Maps API失败，使用备用地图");
                                initMapWithoutAPI();
                            };
                            document.body.appendChild(script);
                        } catch (e) {
                            console.error("加载脚本时出错:", e);
                            initMapWithoutAPI();
                        }
                    }
                </script> -->
            </div>
        </div>
    </div>

    <!-- 添加浮窗触发按钮 -->
    <div class="filter-trigger" onclick="toggleFilterModal()">
        <i>⚙️</i>
			 			            </div>
    
    <!-- 添加筛选浮窗 -->
    <div id="filter-modal" class="filter-modal collapsed">
        <h3>
            Data Filter
            <button onclick="toggleFilterModal()">✕</button>
        </h3>
        
        <div class="form-group">
            <label for="station-select">Select Station:</label>
            <select id="station-select">
                <option value="">All Stations</option>
                <!-- Station options will be dynamically populated by JavaScript -->
            </select>
            </div>
        
        <div class="form-group">
            <label for="time-select">Select Time:</label>
            <select id="time-select">
                <option value="0">00:00</option>
                <option value="1">01:00</option>
                <option value="2">02:00</option>
                <option value="3">03:00</option>
                <option value="4">04:00</option>
                <option value="5">05:00</option>
                <option value="6">06:00</option>
                <option value="7">07:00</option>
                <option value="8">08:00</option>
                <option value="9">09:00</option>
                <option value="10">10:00</option>
                <option value="11">11:00</option>
                <option value="12">12:00</option>
                <option value="13">13:00</option>
                <option value="14">14:00</option>
                <option value="15">15:00</option>
                <option value="16">16:00</option>
                <option value="17">17:00</option>
                <option value="18">18:00</option>
                <option value="19">19:00</option>
                <option value="20">20:00</option>
                <option value="21">21:00</option>
                <option value="22">22:00</option>
                <option value="23">23:00</option>
            </select>
        </div>
        
        <div class="actions">
            <button class="reset-btn" onclick="resetFilters()">Reset</button>
            <button class="apply-btn" onclick="applyFilters()">Apply</button>
    </div>

        <!-- Data Results Display Area -->
        <div id="filter-results" class="filter-results">
            <div class="results-header">
                <h4>Filter Results</h4>
            </div>
            <div class="results-content">
                <!-- Backend data will be displayed here -->
                <p class="placeholder-text">Results will be displayed after applying filters...</p>
            </div>
        </div>
    </div>

    <!-- 添加站点详情弹窗 -->
    <div id="station-popup" class="station-popup" onclick="event.stopPropagation()">
      <div class="station-popup-header">
        <h3 id="station-popup-title">Station Details</h3>
        <button class="station-popup-close" onclick="closeStationPopup()">✕</button>
      </div>
      <div class="station-popup-body">
        <!-- 添加跳转到行程规划的按钮 -->
        <div style="display: flex; justify-content: center; margin-bottom: 15px;">
          <button id="to-journey-planner-btn" style="background-color: #4285f4; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">Plan My Journey</button>
        </div>
        
        <div class="station-popup-info" id="station-popup-content">
          <!-- 站点信息将动态填充 -->
        </div>
        
        <!-- 站点统计图表 -->
        <div class="station-charts" id="station-charts">
          <div class="station-chart">
            <h4>Average Available Bikes (by hour)</h4>
            <div class="chart-container" id="bikes-chart-container"></div>
            <div class="time-labels" id="bikes-time-labels"></div>
          </div>
          
          <div class="station-chart">
            <h4>Average Available Stands (by hour)</h4>
            <div class="chart-container" id="stands-chart-container"></div>
            <div class="time-labels" id="stands-time-labels"></div>
          </div>
        </div>
        
        <!-- 将按钮移到图表底部 -->
        <div class="station-popup-actions" style="margin-top: 20px; border-top: 1px solid #e0e0e0; padding-top: 15px;">
          <button class="station-popup-btn start" id="set-as-start-btn">Set as Start</button>
          <button class="station-popup-btn end" id="set-as-end-btn">Set as End</button>
        </div>
      </div>
    </div>
    
    <!-- 添加行程规划弹窗 -->
    <div id="journey-planner-popup" class="station-popup" style="display: none;" onclick="event.stopPropagation()">
      <div class="station-popup-header">
        <h3>Journey Planner</h3>
        <button class="station-popup-close" onclick="closeJourneyPlannerPopup()">✕</button>
      </div>
      <div class="station-popup-body">
        <!-- 添加返回站点详情的按钮 -->
        <div style="display: flex; justify-content: center; margin-bottom: 15px;">
          <button id="back-to-station-btn" style="background-color: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">Back to Station Details</button>
        </div>
        <div class="journey-planner-content">
          <!-- 日期选择 -->
          <div class="date-selector">
            <div class="date-option">
              <input type="radio" id="date-today" name="journey-date" value="today" checked>
              <label for="date-today">Today</label>
            </div>
            <div class="date-option">
              <input type="radio" id="date-tomorrow" name="journey-date" value="tomorrow">
              <label for="date-tomorrow">Tomorrow</label>
            </div>
            <div class="date-option">
              <input type="radio" id="date-next-day" name="journey-date" value="next-day">
              <label for="date-next-day">The Next Day</label>
            </div>
          </div>
          
          <!-- 时间选择 -->
          <div class="time-selector">
            <label for="journey-time">Time:</label>
            <select id="journey-time">
              <option value="00:05">00:05</option>
              <option value="01:00">01:00</option>
              <option value="02:00">02:00</option>
              <option value="03:00">03:00</option>
              <option value="04:00">04:00</option>
              <option value="05:00">05:00</option>
              <option value="06:00">06:00</option>
              <option value="07:00">07:00</option>
              <option value="08:00">08:00</option>
              <option value="09:00">09:00</option>
              <option value="10:00">10:00</option>
              <option value="11:00">11:00</option>
              <option value="12:00">12:00</option>
              <option value="13:00">13:00</option>
              <option value="14:00">14:00</option>
              <option value="15:00">15:00</option>
              <option value="16:00">16:00</option>
              <option value="17:00">17:00</option>
              <option value="18:00">18:00</option>
              <option value="19:00">19:00</option>
              <option value="20:00">20:00</option>
              <option value="21:00">21:00</option>
              <option value="22:00">22:00</option>
              <option value="23:00">23:00</option>
            </select>
          </div>
          
          <!-- 起点输入 -->
          <div class="location-input">
            <label for="start-location">Start:</label>
            <input type="text" id="start-location" placeholder="Enter start location...">
          </div>
          
          <!-- 终点输入 -->
          <div class="location-input">
            <label for="end-location">End:</label>
            <input type="text" id="end-location" placeholder="Enter destination...">
          </div>
          
          <!-- 按钮 -->
          <button id="submit-journey" class="btn">Submit</button>
          <button id="directions-button" class="btn btn-secondary">Directions</button>
        </div>
        
        <!-- 路线详情（初始隐藏） -->
        <div id="route-details" class="route-details" style="display: none;">
          <h3>Route Details</h3>
          <div id="route-info-content">
            <!-- 路线详情内容将通过JavaScript动态填充 -->
          </div>
        </div>
      </div>
    </div>
	       
    <!-- 添加遮罩层，添加onclick事件 -->
    <div id="overlay" class="overlay" onclick="closeAllPopups()"></div>

    <!-- <script src="{{ url_for('static', filename='dublin_bikes_app.js') }}"></script> -->
    <script src="{{ url_for('static', filename='step_by_step.js') }}"></script>
  </body>
</html>

