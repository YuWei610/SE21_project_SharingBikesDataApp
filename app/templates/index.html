<!DOCTYPE html>
<html>
  <head>
    <title>Google Map Example</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='static/dublin_bikes_app.css')}}">
    <script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}"></script>
</head>
<body>
    <!-- 导航栏 -->
    <div class="navbar">
        <div class="logo">Dublin Bikes</div>
        <div class="weather-container">
            <div class="weather" id="weather">Loading weather...</div>
        </div>
        <div class="nav-links">
            <a href="#">View Map</a>
            <a href="#">View Stations</a>
		</div>
    </div>

    <!-- 侧边栏和地图 -->
    <div class="container">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <h2>Plan Your Journey</h2>
            <form id="route-planner-form">
                <div class="form-control">
                    <label for="start-location">Start location:</label>
                    <input type="text" id="start-location" placeholder="Enter start location..."/>
                </div>
                
                <div class="form-control">
                    <label for="end-location">End location:</label>
                    <input type="text" id="end-location" placeholder="Enter end location..."/>
                </div>
                
                <div class="form-control">
                    <label for="day-select">Select date:</label>
                    <select id="day-select">
                    <option value="Sunday">Sunday</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                </select>
                </div>
                
                <div class="form-control">
                    <label for="time-select">Select time:</label>
                    <select id="time-select">
                    <option value="5">5:00</option>
                    <option value="6">6:00</option>
                    <option value="7">7:00</option>
                    <option value="8">8:00</option>
                    <option value="9">9:00</option>
                    <option value="10">10:00</option>
                    <option value="11">11:00</option>
                    <option value="12">12:00</option>
                    <option value="13">13:00</option>
                    <option value="14">14:00</option>
                    <option value="15">15:00</option>
                    <option value="16">16:00</option>
                    <option value="17">17:00</option>
                    <option value="18">18:00</option>
                    <option value="19">19:00</option>
                    <option value="20">20:00</option>
                    <option value="21">21:00</option>
                </select>
                </div>
                
                <div class="form-control">
                    <button type="button" id="plan-journey-btn">Plan route</button>
                </div>
            </form>
            
            <!-- 路线详情容器 -->
            <div id="route-details" style="display: none;">
                <h3>Route details</h3>
                <div id="route-details-content"></div>
            </div>
            
            <!-- 添加站点详情面板 -->
            <div id="station-details" style="display: none;">
                <h3>Station details</h3>
                <div id="station-info-content"></div>
            </div>
        </div>

        <!-- 地图部分 -->
        <div class="map">
			 <div class="map-buttons">
				 <form action="station.html">
                    <button id="zoom-in" type="submit">Plan Your Journey</button>					
				 </form>
                <button id="zoom-out" type="button" data-hidden="false">Hide Stations</button>
            </div>
            <div id="map" style="width: 100%; height: 100%;">
                <!-- 移除Google Maps API的异步加载 -->
                <script>
                    // 改为不依赖Google API的初始化
                    window.onload = function() {
                        // 如果没有Google Maps API，则使用备用初始化方法
                        if (typeof google === 'undefined') {
                            console.log("Google Maps API 不可用，使用备用地图显示");
                            initMapWithoutAPI();
                        } else {
                            loadGoogleMapsScript();
                        }
                    };
                    
                    function loadGoogleMapsScript() {
                        try {
                            const script = document.createElement('script');
                            script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyBm9UnzDLdgIHQ1i_Fp4zfRZL6nuEM73t8&libraries=places,directions&language=zh-CN&callback=initMap';
                            script.async = true;
                            script.defer = true;
                            script.onerror = function() {
                                console.error("加载Google Maps API失败，使用备用地图");
                                initMapWithoutAPI();
                            };
                            document.body.appendChild(script);
                        } catch (e) {
                            console.error("加载脚本时出错:", e);
                            initMapWithoutAPI();
                        }
                    }
                </script>
            </div>
        </div>
    </div>

    <!-- 添加浮窗触发按钮 -->
    <div class="filter-trigger" onclick="toggleFilterModal()">
        <i>⚙️</i>
			 			            </div>
    
    <!-- 添加筛选浮窗 -->
    <div id="filter-modal" class="filter-modal collapsed">
        <h3>
            数据筛选
            <button onclick="toggleFilterModal()">✕</button>
        </h3>
        
        <div class="form-group">
            <label for="station-select">选择站点:</label>
            <select id="station-select">
                <option value="">所有站点</option>
                <!-- 站点选项将由JavaScript动态填充 -->
            </select>
            </div>
        
        <div class="form-group">
            <label for="time-select">选择时刻:</label>
            <select id="time-select">
                <option value="0">00:00</option>
                <option value="1">01:00</option>
                <option value="2">02:00</option>
                <option value="3">03:00</option>
                <option value="4">04:00</option>
                <option value="5">05:00</option>
                <option value="6">06:00</option>
                <option value="7">07:00</option>
                <option value="8">08:00</option>
                <option value="9">09:00</option>
                <option value="10">10:00</option>
                <option value="11">11:00</option>
                <option value="12">12:00</option>
                <option value="13">13:00</option>
                <option value="14">14:00</option>
                <option value="15">15:00</option>
                <option value="16">16:00</option>
                <option value="17">17:00</option>
                <option value="18">18:00</option>
                <option value="19">19:00</option>
                <option value="20">20:00</option>
                <option value="21">21:00</option>
                <option value="22">22:00</option>
                <option value="23">23:00</option>
            </select>
        </div>
        
        <div class="actions">
            <button class="reset-btn" onclick="resetFilters()">重置</button>
            <button class="apply-btn" onclick="applyFilters()">应用</button>
    </div>

        <!-- 新增数据结果显示区域 -->
        <div id="filter-results" class="filter-results">
            <div class="results-header">
                <h4>筛选结果</h4>
            </div>
            <div class="results-content">
                <!-- 这里会显示后端返回的数据 -->
                <p class="placeholder-text">应用筛选后将显示结果...</p>
            </div>
        </div>
    </div>

    <!-- 添加站点详情弹窗 -->
    <div id="station-popup" class="station-popup">
      <div class="station-popup-header">
        <h3 id="station-popup-title">Station Details</h3>
        <button class="station-popup-close" onclick="closeStationPopup()">✕</button>
      </div>
      <div class="station-popup-body">
        <div class="station-popup-info" id="station-popup-content">
          <!-- 站点信息将动态填充 -->
        </div>
        
        <!-- 站点统计图表 -->
        <div class="station-charts" id="station-charts">
          <div class="station-chart">
            <h4>Average Available Bikes (by hour)</h4>
            <div class="chart-container" id="bikes-chart-container"></div>
            <div class="time-labels" id="bikes-time-labels"></div>
          </div>
          
          <div class="station-chart">
            <h4>Average Available Stands (by hour)</h4>
            <div class="chart-container" id="stands-chart-container"></div>
            <div class="time-labels" id="stands-time-labels"></div>
          </div>
        </div>
      </div>
      
      <div class="station-popup-actions">
        <button class="station-popup-btn start" id="set-as-start-btn">Set as Start</button>
        <button class="station-popup-btn end" id="set-as-end-btn">Set as End</button>
      </div>
    </div>
  </body>
</html>

